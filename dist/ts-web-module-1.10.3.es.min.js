var e=Object.defineProperty,o=(o,t,n)=>(((o,t,n)=>{t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n})(o,"symbol"!=typeof t?t+"":t,n),n);const t={},n=function(e,o,n){if(!o||0===o.length)return e();const s=document.getElementsByTagName("link");return Promise.all(o.map(e=>{if(e=function(e,o){return new URL(e,o).href}(e,n),e in t)return;t[e]=!0;const o=e.endsWith(".css"),l=o?'[rel="stylesheet"]':"";if(!!n)for(let t=s.length-1;t>=0;t--){const n=s[t];if(n.href===e&&(!o||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${e}"]${l}`))return;const r=document.createElement("link");return r.rel=o?"stylesheet":"modulepreload",o||(r.as="script",r.crossOrigin=""),r.href=e,document.head.appendChild(r),o?new Promise((o,t)=>{r.addEventListener("load",o),r.addEventListener("error",()=>t(new Error(`Unable to preload CSS for ${e}`)))}):void 0})).then(()=>e()).catch(e=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=e,window.dispatchEvent(o),!o.defaultPrevented)throw e})};class s{static async initConfig(){if(this.configLoadPromise)return this.configLoadPromise;this.configLoadPromise=this.loadConfig(),await this.configLoadPromise}static async loadConfig(){try{const e=await n(()=>import("./ts-web-module-config-1.10.3.es.min.js"),[],import.meta.url);this.moduleConfig={moduleMap:e.moduleMap,customElements:e.customElements}}catch(e){const o=e instanceof Error?e.message:String(e);throw console.error("[TsWebModule] 配置加载失败:",o),new Error(`[TsWebModule] 配置加载失败: ${o}`)}}static getModuleMap(){var e;return(null==(e=this.moduleConfig)?void 0:e.moduleMap)??null}static getCustomElements(){var e;return(null==(e=this.moduleConfig)?void 0:e.customElements)??null}static async loadModule(e){var o;if(this.loadedModules.has(e))return;if(this.loadingModules.has(e))return this.loadingModules.get(e);if(await this.initConfig(),!(null==(o=this.moduleConfig)?void 0:o.moduleMap))return void console.warn("[TsWebModule] 模块配置未加载");const t=this.moduleConfig.moduleMap[e];if(!t)return void console.warn(`[TsWebModule] 未找到模块: ${e}`);const n=t().then(()=>{this.loadedModules.add(e),this.loadingModules.delete(e),console.log(`[TsWebModule] ✓ ${e}`)}).catch(o=>{this.loadingModules.delete(e);const t=o instanceof Error?o.message:String(o);throw console.error(`[TsWebModule] ✗ ${e}:`,t),o});return this.loadingModules.set(e,n),n}static async scanAndLoad(){var e;if(await this.initConfig(),!(null==(e=this.moduleConfig)?void 0:e.customElements))return void console.warn("[TsWebModule] 未找到自定义元素配置");const o=Array.from(new Set(this.moduleConfig.customElements.filter(e=>document.getElementsByTagName(e).length>0&&!this.loadedModules.has(e))));o.length>0&&(console.log(`[TsWebModule] 扫描到 ${o.length} 个模块:`,o.join(", ")),await Promise.all(o.map(e=>this.loadModule(e))))}}o(s,"loadedModules",new Set),o(s,"loadingModules",new Map),o(s,"moduleConfig",null),o(s,"configLoadPromise",null);new MutationObserver(e=>{const o=new Set,t=s.getModuleMap(),n=s.getCustomElements();if(!t||!n)return console.warn("[TsWebModule] 配置未就绪，延迟扫描"),void setTimeout(()=>s.scanAndLoad().catch(console.error),100);e.forEach(e=>{e.addedNodes.forEach(e=>{if(e.nodeType!==Node.ELEMENT_NODE)return;const s=e,l=s.tagName.toLowerCase();t[l]&&o.add(l),s.querySelectorAll(n.join(",")).forEach(e=>{o.add(e.tagName.toLowerCase())})})}),o.size>0&&(console.log(`[TsWebModule] 动态发现 ${o.size} 个组件:`,Array.from(o).join(", ")),o.forEach(e=>{s.loadModule(e).catch(console.error)}))}).observe(document.body,{childList:!0,subtree:!0}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{s.scanAndLoad().catch(console.error)}):s.scanAndLoad().catch(console.error),window.TsWebModule={ModuleLoader:s,loadModule:e=>s.loadModule(e)};export{n as _};
