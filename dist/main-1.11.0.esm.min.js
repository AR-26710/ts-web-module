var e={};const o=function(o,t,n){let s=Promise.resolve();if(t&&t.length>0){const o=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),a=l?.nonce||l?.getAttribute("nonce");r=t.map(t=>{if(t=function(e,o){return new URL(e,o).href}(t,n),t in e)return;e[t]=!0;const s=t.endsWith(".css"),r=s?'[rel="stylesheet"]':"";if(n)for(let e=o.length-1;e>=0;e--){const n=o[e];if(n.href===t&&(!s||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${t}"]${r}`))return;const l=document.createElement("link");return l.rel=s?"stylesheet":"modulepreload",s||(l.as="script"),l.crossOrigin="",l.href=t,a&&l.setAttribute("nonce",a),document.head.appendChild(l),s?new Promise((e,o)=>{l.addEventListener("load",e),l.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${t}`)))}):void 0}),s=Promise.all(r.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))}var r;function l(e){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=e,window.dispatchEvent(o),!o.defaultPrevented)throw e}return s.then(e=>{for(const o of e||[])"rejected"===o.status&&l(o.reason);return o().catch(l)})};var t=class{static loadedModules=new Set;static loadingModules=new Map;static moduleConfig=null;static configLoadPromise=null;static async initConfig(){if(this.configLoadPromise)return this.configLoadPromise;this.configLoadPromise=this.loadConfig(),await this.configLoadPromise}static async loadConfig(){try{const e=await o(()=>import("./ts-web-module-config-1.11.0.esm.min.js"),[],import.meta.url);this.moduleConfig={moduleMap:e.moduleMap,customElements:e.customElements}}catch(e){const o=e instanceof Error?e.message:String(e);throw console.error("[TsWebModule] 配置加载失败:",o),new Error(`[TsWebModule] 配置加载失败: ${o}`)}}static getModuleMap(){return this.moduleConfig?.moduleMap??null}static getCustomElements(){return this.moduleConfig?.customElements??null}static async loadModule(e){if(this.loadedModules.has(e))return;if(this.loadingModules.has(e))return this.loadingModules.get(e);if(await this.initConfig(),!this.moduleConfig?.moduleMap)return void console.warn("[TsWebModule] 模块配置未加载");const o=this.moduleConfig.moduleMap[e];if(!o)return void console.warn(`[TsWebModule] 未找到模块: ${e}`);const t=o().then(()=>{this.loadedModules.add(e),this.loadingModules.delete(e),console.log(`[TsWebModule] ✓ ${e}`)}).catch(o=>{this.loadingModules.delete(e);const t=o instanceof Error?o.message:String(o);throw console.error(`[TsWebModule] ✗ ${e}:`,t),o});return this.loadingModules.set(e,t),t}static async scanAndLoad(){if(await this.initConfig(),!this.moduleConfig?.customElements)return void console.warn("[TsWebModule] 未找到自定义元素配置");const e=Array.from(new Set(this.moduleConfig.customElements.filter(e=>document.getElementsByTagName(e).length>0&&!this.loadedModules.has(e))));e.length>0&&(console.log(`[TsWebModule] 扫描到 ${e.length} 个模块:`,e.join(", ")),await Promise.all(e.map(e=>this.loadModule(e))))}};new MutationObserver(e=>{const o=new Set,n=t.getModuleMap(),s=t.getCustomElements();if(!n||!s)return console.warn("[TsWebModule] 配置未就绪，延迟扫描"),void setTimeout(()=>t.scanAndLoad().catch(console.error),100);e.forEach(e=>{e.addedNodes.forEach(e=>{if(e.nodeType!==Node.ELEMENT_NODE)return;const t=e,r=t.tagName.toLowerCase();n[r]&&o.add(r),t.querySelectorAll(s.join(",")).forEach(e=>{o.add(e.tagName.toLowerCase())})})}),o.size>0&&(console.log(`[TsWebModule] 动态发现 ${o.size} 个组件:`,Array.from(o).join(", ")),o.forEach(e=>{t.loadModule(e).catch(console.error)}))}).observe(document.body,{childList:!0,subtree:!0}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{t.scanAndLoad().catch(console.error)}):t.scanAndLoad().catch(console.error),window.TsWebModule={ModuleLoader:t,loadModule:e=>t.loadModule(e)};export{o as t};