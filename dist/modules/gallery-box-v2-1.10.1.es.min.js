var t=Object.defineProperty,e=(e,n,i)=>(((e,n,i)=>{n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i})(e,"symbol"!=typeof n?n+"":n,i),i);class n extends HTMLElement{constructor(){super(),e(this,"currentIndex",0),e(this,"items",[]),e(this,"container"),e(this,"track"),e(this,"counter"),e(this,"prevButton"),e(this,"nextButton"),e(this,"loadedIndices",new Set),e(this,"preloadDistance",4),e(this,"transitionDuration",300),e(this,"isTransitioning",!1),e(this,"observer",null),e(this,"resizeTimeout",null),e(this,"root"),e(this,"loopDirection",null),e(this,"cloneElement",null);const t=this.getAttribute("mode");this.root="shadow"===t?this.attachShadow({mode:"open"}):this,this.container=document.createElement("div"),this.track=document.createElement("div"),this.counter=document.createElement("div"),this.prevButton=document.createElement("button"),this.nextButton=document.createElement("button"),this.render(),this.applyCustomProperties()}connectedCallback(){this.buildGallery(),this.setupIntersectionObserver(),this.addEventListeners(),this.loadVisibleImages()}disconnectedCallback(){this.removeEventListeners(),this.cleanupIntersectionObserver()}static get observedAttributes(){return["pd","td","mode"]}attributeChangedCallback(t,e,n){if("mode"!==t){if("pd"===t&&n){const t=parseInt(n,10);!isNaN(t)&&t>0&&(this.preloadDistance=Math.min(t,4),this.loadVisibleImages())}if("td"===t&&n){const t=parseInt(n,10);!isNaN(t)&&t>0&&(this.transitionDuration=t,this.track.style.transition=`transform ${this.transitionDuration}ms ease`)}}else console.warn("Mode cannot be changed dynamically.")}render(){const t=document.createElement("style");t.textContent="\n      .gbv2-gallery-container {\n        position: relative;\n        width: 100%;\n        max-width: 800px;\n        margin: 0 auto;\n        overflow: hidden;\n        border-radius: 8px;\n      }\n\n      .gbv2-gallery-track {\n        display: flex;\n      }\n\n      .gbv2-gallery-item {\n        min-width: 100%;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n      }\n\n      .gbv2-gallery-item img {\n        max-width: 100%;\n        max-height: 600px;\n        object-fit: contain;\n        transition: opacity 0.3s ease;\n      }\n\n      .gbv2-gallery-item img.loading {\n        opacity: 0.3;\n        background: #f5f5f5;\n      }\n\n      .gbv2-gallery-item img.loaded {\n        opacity: 1;\n      }\n\n      .gbv2-gallery-item img.error {\n        opacity: 1;\n        background: #ffebee;\n        color: #b71c1c;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        min-height: 200px;\n      }\n\n      .gbv2-gallery-nav {\n        position: absolute;\n        top: 50%;\n        transform: translateY(-50%);\n        background: rgba(0, 0, 0, 0.5);\n        color: white;\n        border: none;\n        font-size: 24px;\n        padding: 12px 16px;\n        cursor: pointer;\n        transition: background 0.3s;\n        user-select: none;\n        z-index: 10;\n      }\n\n      .gbv2-gallery-nav:hover {\n        background: rgba(0, 0, 0, 0.8);\n      }\n\n      .gbv2-gallery-nav:focus {\n        outline: 2px solid rgba(255, 255, 255, 0.8);\n        outline-offset: 2px;\n      }\n\n      .gbv2-gallery-nav.prev {\n        left: 16px;\n      }\n\n      .gbv2-gallery-nav.next {\n        right: 16px;\n      }\n\n      .gbv2-gallery-counter {\n        position: absolute;\n        bottom: 16px;\n        right: 16px;\n        background: rgba(0, 0, 0, 0.5);\n        color: white;\n        padding: 4px 12px;\n        border-radius: 12px;\n        font-size: 14px;\n        z-index: 10;\n      }\n    ",this.container.className="gbv2-gallery-container",this.track.className="gbv2-gallery-track",this.track.style.transition=`transform ${this.transitionDuration}ms ease`,this.prevButton.className="gbv2-gallery-nav prev",this.prevButton.innerHTML="‹",this.prevButton.setAttribute("aria-label","Previous image"),this.nextButton.className="gbv2-gallery-nav next",this.nextButton.innerHTML="›",this.nextButton.setAttribute("aria-label","Next image"),this.counter.className="gbv2-gallery-counter",this.container.append(this.track,this.prevButton,this.nextButton,this.counter),this.root.appendChild(t),this.root.appendChild(this.container)}applyCustomProperties(){const t=this.getAttribute("pd"),e=this.getAttribute("td");if(t){const e=parseInt(t,10);!isNaN(e)&&e>0&&(this.preloadDistance=Math.min(e,4))}if(e){const t=parseInt(e,10);!isNaN(t)&&t>0&&(this.transitionDuration=t,this.track.style.transition=`transform ${this.transitionDuration}ms ease`)}}buildGallery(){this.items=Array.from(this.children).filter(t=>{var e;return!(null==(e=t.classList)?void 0:e.contains("gbv2-gallery-container"))&&"STYLE"!==t.tagName}),this.track.innerHTML="",this.items.forEach((t,e)=>{const n=document.createElement("div");if(n.className="gbv2-gallery-item",n.dataset.index=e.toString(),"IMG"===t.tagName){const n=t,i=n.src;n.src="",n.dataset.src=i,n.classList.add("loading"),n.alt=n.alt||`Image ${e+1}`}else if(t.querySelector("img")){const e=t.querySelector("img"),n=e.src;e.src="",e.dataset.src=n,e.classList.add("loading")}n.appendChild(t),this.track.appendChild(n)}),this.updateCounter()}setupIntersectionObserver(){this.observer=new IntersectionObserver(t=>{t.forEach(t=>{if(t.isIntersecting){const e=parseInt(t.target.dataset.index||"0",10);this.loadImageAtIndex(e)}})},{root:this.container,threshold:.1,rootMargin:100*this.preloadDistance+"%"}),this.items.forEach((t,e)=>{var n;const i=this.track.children[e];null==(n=this.observer)||n.observe(i)})}cleanupIntersectionObserver(){this.observer&&(this.observer.disconnect(),this.observer=null)}addEventListeners(){this.prevButton.addEventListener("click",()=>this.prev()),this.nextButton.addEventListener("click",()=>this.next()),this.track.addEventListener("transitionend",this.handleTransitionEnd.bind(this)),window.addEventListener("resize",this.throttleResize.bind(this)),document.addEventListener("keydown",this.handleKeyDown.bind(this))}removeEventListeners(){this.prevButton.removeEventListener("click",()=>this.prev()),this.nextButton.removeEventListener("click",()=>this.next()),this.track.removeEventListener("transitionend",this.handleTransitionEnd.bind(this)),window.removeEventListener("resize",this.throttleResize.bind(this)),document.removeEventListener("keydown",this.handleKeyDown.bind(this))}throttleResize(){this.resizeTimeout||(this.resizeTimeout=window.setTimeout(()=>{this.handleResize(),this.resizeTimeout=null},100))}handleTransitionEnd(t){t.target===this.track&&(this.isTransitioning=!1,this.cloneElement&&(this.track.removeChild(this.cloneElement),this.cloneElement=null),"next"===this.loopDirection?(this.track.style.transition="none",this.currentIndex=0,this.track.style.transform="translateX(0%)",this.track.offsetWidth,this.track.style.transition=`transform ${this.transitionDuration}ms ease`,this.loopDirection=null):"prev"===this.loopDirection&&(this.track.style.transition="none",this.currentIndex=this.items.length-1,this.track.style.transform=`translateX(-${100*this.currentIndex}%)`,this.track.offsetWidth,this.track.style.transition=`transform ${this.transitionDuration}ms ease`,this.loopDirection=null),this.updateCounter(),this.loadVisibleImages(),this.cleanupFarImages())}handleResize(){this.track.style.transition="none",this.track.style.transform=`translateX(-${100*this.currentIndex}%)`,this.track.offsetWidth,this.track.style.transition=`transform ${this.transitionDuration}ms ease`,this.loadVisibleImages()}handleKeyDown(t){"ArrowLeft"===t.key?(this.prev(),t.preventDefault()):"ArrowRight"===t.key&&(this.next(),t.preventDefault())}updateGallery(){this.isTransitioning||(this.isTransitioning=!0,this.track.style.transform=`translateX(-${100*this.currentIndex}%)`,this.updateCounter())}loadVisibleImages(){if(0===this.items.length)return;const t=Math.max(0,this.currentIndex-this.preloadDistance),e=Math.min(this.items.length-1,this.currentIndex+this.preloadDistance);for(let n=t;n<=e;n++)this.loadedIndices.has(n)||this.loadImageAtIndex(n)}cleanupFarImages(){const t=2*this.preloadDistance,e=Math.max(0,this.currentIndex-t),n=Math.min(this.items.length-1,this.currentIndex+t);this.loadedIndices.forEach(t=>{if(t<e||t>n){const e=this.items[t],n=this.getImageFromItem(e);n&&n.src&&(n.src="",n.classList.remove("loaded","error"),n.classList.add("loading"),this.loadedIndices.delete(t))}})}getImageFromItem(t){return"IMG"===t.tagName?t:t.querySelector("img")}loadImageAtIndex(t){if(t<0||t>=this.items.length||this.loadedIndices.has(t))return;const e=this.items[t],n=this.getImageFromItem(e);if(n&&n.dataset.src){const e=n.dataset.src,i=new Image;i.onload=()=>{n.src=e,n.classList.remove("loading","error"),n.classList.add("loaded"),this.loadedIndices.add(t)},i.onerror=()=>{n.classList.remove("loading"),n.classList.add("error"),n.title="Failed to load image"},i.src=e}}updateCounter(){this.items.length>0&&(this.counter.textContent=`${this.currentIndex+1} / ${this.items.length}`,this.counter.setAttribute("aria-label",`Image ${this.currentIndex+1} of ${this.items.length}`))}prev(){if(this.isTransitioning||this.items.length<=1)return;const t=(this.currentIndex-1+this.items.length)%this.items.length;this.slideToIndex(t,"prev")}next(){if(this.isTransitioning||this.items.length<=1)return;const t=(this.currentIndex+1)%this.items.length;this.slideToIndex(t,"next")}slideToIndex(t,e){("next"===e&&0===t&&this.currentIndex===this.items.length-1||"prev"===e&&t===this.items.length-1&&0===this.currentIndex)&&this.items.length>1?(this.loopDirection=e,this.handleLoopTransition(e)):(this.currentIndex=t,this.updateGallery())}handleLoopTransition(t){if("next"===t){const t=this.track.children[0];this.cloneElement=t.cloneNode(!0),this.track.appendChild(this.cloneElement),this.currentIndex=this.items.length,this.track.style.transform=`translateX(-${100*this.currentIndex}%)`,this.isTransitioning=!0}else{const t=this.track.children[this.items.length-1];this.cloneElement=t.cloneNode(!0),this.track.insertBefore(this.cloneElement,this.track.firstChild),this.track.style.transition="none",this.track.style.transform="translateX(-100%)",this.track.offsetWidth,this.track.style.transition=`transform ${this.transitionDuration}ms ease`,this.track.style.transform="translateX(0%)",this.isTransitioning=!0}}goTo(t){if(t>=0&&t<this.items.length&&t!==this.currentIndex&&!this.isTransitioning){const e=t>this.currentIndex?"next":"prev";this.slideToIndex(t,e)}}getCurrentIndex(){return this.currentIndex}}customElements.define("gallery-box-v2",n);const i="gallery-box-v2";export{i as GALLERY_BOX_V2_MODULE};
