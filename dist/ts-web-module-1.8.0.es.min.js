var e=Object.defineProperty,o=(o,t,n)=>(((o,t,n)=>{t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n})(o,"symbol"!=typeof t?t+"":t,n),n);const t={},n=function(e,o,n){if(!o||0===o.length)return e();const l=document.getElementsByTagName("link");return Promise.all(o.map(e=>{if(e=function(e,o){return new URL(e,o).href}(e,n),e in t)return;t[e]=!0;const o=e.endsWith(".css"),r=o?'[rel="stylesheet"]':"";if(!!n)for(let t=l.length-1;t>=0;t--){const n=l[t];if(n.href===e&&(!o||"stylesheet"===n.rel))return}else if(document.querySelector(`link[href="${e}"]${r}`))return;const s=document.createElement("link");return s.rel=o?"stylesheet":"modulepreload",o||(s.as="script",s.crossOrigin=""),s.href=e,document.head.appendChild(s),o?new Promise((o,t)=>{s.addEventListener("load",o),s.addEventListener("error",()=>t(new Error(`Unable to preload CSS for ${e}`)))}):void 0})).then(()=>e()).catch(e=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=e,window.dispatchEvent(o),!o.defaultPrevented)throw e})};class l{static async initConfig(){if(this.configLoadPromise)return this.configLoadPromise;this.configLoadPromise=this.loadConfig(),await this.configLoadPromise}static async loadConfig(){try{const e=await n(()=>import("./ts-web-module-config-1.8.0.es.min.js"),[],import.meta.url);this.moduleConfig={moduleMap:e.moduleMap,customElements:e.customElements}}catch(e){throw console.error("加载模块配置失败:",e),new Error(`模块配置加载失败: ${e}`)}}static getModuleMap(){var e;return(null==(e=this.moduleConfig)?void 0:e.moduleMap)??null}static getCustomElements(){var e;return(null==(e=this.moduleConfig)?void 0:e.customElements)??null}static async loadModule(e){var o;if(this.loadedModules.has(e))return;if(this.loadingModules.has(e))return this.loadingModules.get(e);if(await this.initConfig(),!(null==(o=this.moduleConfig)?void 0:o.moduleMap))return void console.warn("模块配置未加载");const t=this.moduleConfig.moduleMap[e];if(!t)return void console.warn(`未找到模块 ${e}`);const n=t().then(()=>{this.loadedModules.add(e),this.loadingModules.delete(e),console.log(`模块 ${e} 加载成功`)}).catch(o=>{throw this.loadingModules.delete(e),console.error(`加载模块 ${e} 失败：`,o),o});return this.loadingModules.set(e,n),n}static async scanAndLoad(){var e;if(await this.initConfig(),!(null==(e=this.moduleConfig)?void 0:e.customElements))return void console.warn("未找到自定义元素配置");const o=Array.from(new Set(this.moduleConfig.customElements.filter(e=>document.getElementsByTagName(e).length>0&&!this.loadedModules.has(e))));o.length>0&&(console.log(`找到 ${o.length} 个需要加载的模块：`,o),await Promise.all(o.map(e=>this.loadModule(e))))}}o(l,"loadedModules",new Set),o(l,"loadingModules",new Map),o(l,"moduleConfig",null),o(l,"configLoadPromise",null);new MutationObserver(e=>{const o=new Set,t=l.getModuleMap(),n=l.getCustomElements();if(!t||!n)return console.warn("模块配置未加载，延迟进行 DOM 扫描"),void setTimeout(()=>l.scanAndLoad().catch(console.error),100);e.forEach(e=>{e.addedNodes.forEach(e=>{if(e.nodeType!==Node.ELEMENT_NODE)return;const l=e,r=l.tagName.toLowerCase();t[r]&&o.add(r),l.querySelectorAll(n.join(",")).forEach(e=>{o.add(e.tagName.toLowerCase())})})}),o.size>0&&(console.log(`发现 ${o.size} 个新组件:`,Array.from(o)),o.forEach(e=>{l.loadModule(e).catch(console.error)}))}).observe(document.body,{childList:!0,subtree:!0}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{l.scanAndLoad().catch(console.error)}):l.scanAndLoad().catch(console.error),window.TsWebModule={ModuleLoader:l,loadModule:e=>l.loadModule(e)};export{n as _};
