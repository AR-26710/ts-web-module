var e=Object.defineProperty,o=(o,s,l)=>(((o,s,l)=>{s in o?e(o,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[s]=l})(o,"symbol"!=typeof s?s+"":s,l),l);class s{static async loadModule(e){if(this.loadedModules.has(e))return;if(this.loadingModules.has(e))return this.loadingModules.get(e);const o=this.moduleMap[e];if(!o)return void console.warn(`未找到标签 ${e} 对应的模块`);const s=o().then(()=>{this.loadedModules.add(e),this.loadingModules.delete(e),console.log(`模块 ${e} 加载成功`)}).catch(o=>{throw this.loadingModules.delete(e),console.error(`模块 ${e} 加载失败:`,o),o});return this.loadingModules.set(e,s),s}static async scanAndLoad(){const e=[];["bilibili-video","resource-link","text-box","cloud-drive","progress-box","tabs-component","perspective-view","gallery-component","gallery-no-shadow"].forEach(o=>{document.getElementsByTagName(o).length>0&&!this.loadedModules.has(o)&&e.push(o)}),e.length>0&&(console.log(`发现 ${e.length} 个需要加载的模块:`,e),await Promise.all(e.map(e=>this.loadModule(e))))}}o(s,"loadedModules",new Set),o(s,"loadingModules",new Map),o(s,"moduleMap",{"bilibili-video":()=>import("./modules/bilibili-embed-1.7.9.es.min.js"),"resource-link":()=>import("./modules/resource-link-1.7.9.es.min.js"),"text-box":()=>import("./modules/text-box-1.7.9.es.min.js"),"cloud-drive":()=>import("./modules/cloud-drive-1.7.9.es.min.js"),"progress-box":()=>import("./modules/progress-box-1.7.9.es.min.js"),"tabs-component":()=>import("./modules/tabs-1.7.9.es.min.js"),"perspective-view":()=>import("./modules/perspective-view-1.7.9.es.min.js"),"gallery-component":()=>import("./modules/gallery-1.7.9.es.min.js"),"gallery-no-shadow":()=>import("./modules/gallery-no-shadow-1.7.9.es.min.js")});new MutationObserver(e=>{const o=new Set;e.forEach(e=>{e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const l=e,d=l.tagName.toLowerCase();s.moduleMap[d]&&o.add(d),l.querySelectorAll(Object.keys(s.moduleMap).join(",")).forEach(e=>{o.add(e.tagName.toLowerCase())})}})}),o.size>0&&(console.log(`发现 ${o.size} 个新组件:`,Array.from(o)),o.forEach(e=>{s.loadModule(e).catch(console.error)}))}).observe(document.body,{childList:!0,subtree:!0}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{s.scanAndLoad().catch(console.error)}):s.scanAndLoad().catch(console.error),window.TsWebModule={ModuleLoader:s,loadModule:e=>s.loadModule(e)};
